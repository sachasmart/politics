<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Future Majority Microsite</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://use.fontawesome.com/9fbf27f3f0.js"></script>
        <!-- put in fonts here-->
        <script src="script.js" defer></script>
        <link rel="stylesheet" type="text/css" href="css/main.css" media="screen" />
        <link rel="shortcut icon" type="image/jpg" href="images/favicon.png" />

    </head>

<div class ="container">
        <nav class="navbar">
            <a href="https://www.futuremajority.ca/"><img class="logo" src="images/logo.webp" alt="logo"></a>
            <a href="#" class="toggle-button">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </a>
            <ul class="nav_links">
                <li><a href="#">Work With Us</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Media</a></li>
                <li><a href="#">Blog</a></li>
            </ul>
            <!--- Search -->
            <div id="search">
                <form onsubmit="userAction()" action="javascript:">
                    <input type="text" onsubmit="userAction()" autocomplete="off" id="myInput" class="form-control"
                        placeholder="" aria-label="Search"
                        style="font-size: 1em; border:none">
                </form>
                </div>
                <div id="results">
                    <p></p>
                </div>
                <script>
                    function userAction() {
                        let searchString = document.getElementById("myInput").value;
                        let txt = "";
                        console.log(searchString);

                        //----------------- MODIFY WEBHOOK_URL BELOW ------------------------

                        let webhook_url =
                            "https://us-east-1.aws.webhooks.mongodb-realm.com/api/client/v2.0/app/2019_candidates-tsinp/service/candidate_name/incoming_webhook/getCandidates";

                        let url = webhook_url + "?arg=" + searchString;

                        fetch(url)
                            .then(function (response) {
                                if (!response.ok) {
                                    console.log(response);
                                    txt += `<br><br><br><b>Sadly you have an error. Status: ${response.status}`;
                                    if (response.json.length === 0)
                                        txt +=
                                        `<br><br>Make sure to search for some type of services. Don't leave your search box empty.</b>`;
                                    document.getElementById("results").innerHTML = txt;
                                    throw Error(response.statusText);
                                }
                                return response.json();
                            })
                            .then(function (movieJSON) {
                                if (movieJSON["$undefined"] === true) {
                                    console.log('NO FETCH RESULT');
                                    txt += `<br><br><br><b>No Fetch</b>`;
                                } else {
                                    console.log("FETCHED RESULT... ");
                                    if (movieJSON.length !== 0) {
                                        console.log("Fetched array has " + movieJSON.length + " entries");
                                        txt = buildMovieList(movieJSON);
                                    } else {
                                        console.log("Fetched array has " + movieJSON.length + " entries");
                                        txt +=
                                            `<br><br><br><b>Sadly you have no search results. Try checking your spelling or contacting our <a href="mailto:ahmed.hussen@parl.gc.ca">office </a>to add this service to our database</b>`;
                                    }
                                } // end of ELSE

                                document.getElementById("results").innerHTML = txt;
                            }).catch(function (error) {
                                console.log('Whoopsie! - error', error);
                            });
                    }

                    function buildMovieList(candidates) {
                        // HELPER FUNCTION FOR USER ACTION

                        let i = 0; // for number of movie documents returned
                        let j = 0; // for number of highlight entries
                        let k = 0; // for highlight.texts type entries - either "hit" or "text"
                        let highlight_length = 0;
                        let txt = "";

                        for (i; i < candidates.length; i++) {

                            txt += `<b>${candidates[i].district_number} </b><br>`;
                            txt += `Electoral District: ${candidates[i].electoral_district} <br>`;
                            txt += `Electoral District French: ${candidates[i].electoral_district_fre} <br>`;
                            txt += `Party: ${candidates[i].party} <br>`;
                            txt += `Party FR: ${candidates[i].party_fre} <br>`;
                            txt += `Family Name: ${candidates[i].family_name} <br>`;
                            txt += `First Name: ${candidates[i].first_name} <br>`;
                            txt += `Sacha's Search Score (beta):  ${candidates[i].score["$numberDouble"]} <br>`;

                            // // BUILD OUT HIGHLIGHTS FROM FULLPLOT FIELD
                            // for (j = 0; j < highlight_length; j++) {
                            //     for (k = 0; k < candidates[i].highlight[j].texts.length; k++) {
                            //         if (candidates[i].highlight[j].texts[k].type === "hit") {
                            //             txt +=
                            //                 `<b><span style="background-color: #FFFF00"> ${candidates[i].highlight[j].texts[k].value} </span></b>`;
                            //         } else {
                            //             txt += candidates[i].highlight[j].texts[k].value;
                            //         }
                            //     } // end of k
                            // } // end of j
                            txt += "<hr>";
                        }
                        return txt;
                    }
                </script>
            <!-- End of Search-->
        </nav>
    
    <div id="content1" class="card">
        <div class="box-shadow">
        <img src="images/liberal.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">Liberal Party</div>
        <div class="card_leader">Justin Trudeau</div>
        </div>
    </div>
    <div id="content2" class="card">
        <div class="box-shadow">
        <img src="images/ndp.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">New Democratic Party</div>
        <div class="card_leader">Jagmeet Singh</div>
        </div>
    </div>
    <div id="content3" class="card">
        <div class="box-shadow">
        <img src="images/green.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">Green Party</div>
        <div class="card_leader">Annamie Paul</div>
        </div>
    </div>
    <div id="content4" class="card">
        <div class="box-shadow">
        <img src="images/conservatives.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">Conservative Party</div>
        <div class="card_leader">Erin O'Toole</div>
        </div>
    </div>
    <div id="content5" class="card">
        <div class="box-shadow">
        <img src="images/people.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">People's Party</div>
        <div class="card_leader">Maxime Bernier</div>
        </div>
    </div>
    <div id="content6" class="card">
        <div class="box-shadow">
        <img src="images/bloc.png" alt="" class="card_avatar">
        <div class="card_title"></div>
        <div class="card_party">Bloc Quebecois</div>
        <div class="card_leader">Yves-Francois Blanchet</div>
        </div>
    </div>
</div>
<footer></footer>

</html>